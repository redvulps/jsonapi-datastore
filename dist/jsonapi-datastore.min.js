"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(i,e,a){return e&&t(i.prototype,e),a&&t(i,a),i}}(),JsonApiDataStoreModel=function(){function t(i,e){_classCallCheck(this,t),this.id=e,this._type=i,this._attributes=[],this._relationships=[]}return _createClass(t,[{key:"serialize",value:function(t){var i=this,e={data:{type:this._type}};return t=t||{},t.attributes=t.attributes||this._attributes,t.relationships=t.relationships||this._relationships,void 0!==this.id&&(e.data.id=this.id),0!==t.attributes.length&&(e.data.attributes={}),0!==t.relationships.length&&(e.data.relationships={}),t.attributes.forEach(function(t){e.data.attributes[t]=i[t]}),t.relationships.forEach(function(t){function a(t){return{type:t._type,id:t.id}}i[t]?i[t].constructor===Array?e.data.relationships[t]={data:i[t].map(a)}:e.data.relationships[t]={data:a(i[t])}:e.data.relationships[t]={data:null}}),e}},{key:"setAttribute",value:function(t,i){void 0===this[t]&&this._attributes.push(t),this[t]=i}},{key:"setRelationship",value:function(t,i){void 0===this[t]&&this._relationships.push(t),this[t]=i}}]),t}(),JsonApiDataStore=function(){function t(){_classCallCheck(this,t),this.graph={},this.sortedGraph={}}return _createClass(t,[{key:"destroy",value:function(t){delete this.graph[t._type][t.id]}},{key:"find",value:function(t,i){return this.graph[t]&&this.graph[t][i]?this.graph[t][i]:null}},{key:"findAll",value:function(t,i){var e=this;return i="undefined"!=typeof i&&i,this.graph[t]?i?e.sortedGraph[t].map(function(i){return e.graph[t][i]}):Object.keys(e.graph[t]).map(function(i){return e.graph[t][i]}):[]}},{key:"reset",value:function(){this.graph={},this.sortedGraph={}}},{key:"initModel",value:function(t,i){return this.sortedGraph[t]=this.sortedGraph[t]||[],this.sortedGraph[t].push(i),this.graph[t]=this.graph[t]||{},this.graph[t][i]=this.graph[t][i]||new JsonApiDataStoreModel(t,i),this.graph[t][i]}},{key:"syncRecord",value:function(t){function i(t){if(!a.find(t.type,t.id)){var i=a.initModel(t.type,t.id);i._placeHolder=!0}return a.graph[t.type][t.id]}var e,a=this,r=this.initModel(t.type,t.id);delete r._placeHolder;for(e in t.attributes)r._attributes.indexOf(e)===-1&&r._attributes.push(e),r[e]=t.attributes[e];if(t.links&&(r._links=t.links),t.meta){r._meta=t.meta,r.meta={};for(e in t.meta)r.meta[e]=t.meta[e]}if(t.relationships)for(e in t.relationships){var s=t.relationships[e];void 0!==s.data&&(r._relationships.push(e),null===s.data?r[e]=null:s.data.constructor===Array?r[e]=s.data.map(i):r[e]=i(s.data)),s.links&&(r._links=r._links||{},r._links[e]=s.links)}return r}},{key:"syncWithMeta",value:function(t){var i=t.data,e=this.syncRecord.bind(this);return i?(t.included&&t.included.map(e),{data:i.constructor===Array?i.map(e):e(i),meta:"meta"in t?t.meta:null}):[]}},{key:"sync",value:function(t){return this.syncWithMeta(t).data}}]),t}();"undefined"!=typeof module&&(module.exports={JsonApiDataStore:JsonApiDataStore,JsonApiDataStoreModel:JsonApiDataStoreModel});